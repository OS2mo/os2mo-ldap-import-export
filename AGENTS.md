Project: Integration for bi-directional synchronization of data between OS2mo and LDAP / Active Directory.

# Dataflow

The integration is configured using environmental variables (see `config.py` for details).
What to synchronize is configured using Jinja templates (envvar: `CONVERSION_MAPPING`).

## OS2mo -> LDAP

1. A change happens in OS2mo.
2. OS2mo emits an event on its event system.
3. The FastRAMQPI framework picks up the event and sends a HTTP request to the integration.
4. The integration receives the HTTP call and calls `mo_to_ldap_handler` or `http_process_*`.
5. The handler runs deciding the desired state in LDAP (using configured Jinja templates).
6. The handler calls `ldapapi.ensure_ldap_object` with the desired state.

## LDAP -> OS2mo

1. A change happens in LDAP.
2. The `LDAPEventGenerator` detects the event and emits it on OS2mo's event system.
3. The FastRAMQPI framework picks up the event and sends a HTTP request to the integration.
4. The integration receives the HTTP call and calls `http_process_uuid`.
5. The handler runs deciding the desired state in MO (using configured Jinja templates).
6. The handler calls functions on `MOAPI` with the desired state.

# Development

This project uses `docker compose` for the development environment.
The development stack can be started using `docker compose up --build --detach`

## Running tests

- ALWAYS run tests using: `docker compose exec mo_ldap_import_export pytest ...`.
- NEVER run tests outside the docker container.
- NEVER run the entire test-suite at once.
- ONLY run relevant tests.

## Writing Tests

- ALWAYS add tests for new functionality.
- ALWAYS write integration-tests.
- ONLY write unit-tests for pure functions.
- AVOID using mocks.
- Consider eliminating unit-tests in favor of integration-tests.

## Code style

- Prefer pythonic list comprehensions and generators over `map` / `filter`.

## Commit instructions

- ALWAYS ensure `pre-commit run --all-files` passes before committing.
- ALWAYS use conventional commits.
- ALWAYS include ticket number in commit title: `fix(ldap2mo): [#12345] ensure dry-run termination works`.
- ALWAYS include ticket number in branch name: `fix_12345_ensure_dry_run_termination`
- ALWAYS rebase instead of merging.

## GraphQL Client

- NEVER make edit `autogenerated_graphql_client/` manually.
- ALWAYS regenerate `autogenerated_graphql_client` using `poetry run ./tools/regen_client.sh` if ANYTHING in `queries/*` has changed.
